%!TEX root = htm.tex
\subsection{Lower bound}
%
\sr{Result assumes no cached accesses inside fast-path}
%
\begin{lemma}
\label{lm:hytm}
%
LLet $\mathcal{M}$ be any progressive HyTM implementation.
Let $E\cdot E_1 \cdot E_2$ be an execution of $\mathcal{M}$ where
$E_1$ (and resp. $E_2$) is the step contention-free
execution fragment of fast-path transaction $T_1 \not\in \ms{txns}(E)$ (and
resp. $T_2 \not\in \ms{txns}(E)$),
$T_1$ (and resp. $T_2$) does not conflict with any transaction in $E\cdot E_1 \cdot E_2$. 
Then, $T_1$ and $T_2$ do not contend on any base object in $E\cdot E_1 \cdot E_2$~\cite{htmdisc15}.
\end{lemma}

\begin{theorem}
\label{th:impossibility}
There does not exist any progressive opaque HyTM implementation $\mathcal{M}$ with invisible reads such that in every execution $E$ of $\mathcal{M}$, any t-read operation $op_k$ performed by some slow-path transaction $T_k \in \ms{txns}(E)$
performs $O(1)$ steps.
\end{theorem}
%
\begin{proof}
Suppose by contradiction that there exists a progressive opaque HyTM implementation $\mathcal{M}$ with invisible reads such that in every execution $E$ of $\mathcal{M}$, any t-read operation $op_k$ performed by some slow-path transaction $T_k \in \ms{txns}(E)$
performs $\kappa$ steps.

Let $m \in \mathbb{N}$ be a constant such that $m \gg \kappa$ and for all $i\in \{1,\ldots , m\}$, let $v$ be the initial value of t-object $X_i$.
Let $\pi^{m}$ denote the complete step contention-free execution of a slow-path transaction
$T_{\phi}$ that performs ${m}$ t-reads: $\Read_{\phi}(X_1)\cdots \Read_{\phi}(X_{m})$
such that for all $i\in \{1,\ldots , m \}$, $\Read_{\phi}(X_i) \rightarrow v$.
%
\begin{claim}
\label{cl:readdap}
For all $i\in \mathbb{N}$, $\mathcal{M}$ has an execution of the form $\pi^{i-1}\cdot \rho^i\cdot \alpha^i$ where,
%
\begin{itemize}
\item
$\pi^{i-1}$ is the complete step contention-free execution of slow-path read-only transaction $T_{\phi}$ that performs
$(i-1)$ t-reads: $\Read_{\phi}(X_1)\cdots \Read_{\phi}(X_{i-1})$,
\item
$\rho^i$ is the t-complete step contention-free execution of a fast-path transaction $T_{i}$
that writes $nv_i\neq v_i$ to $X_i$ and commits,
\item
$\alpha_i$ is the complete step contention-free execution fragment of $T_{\phi}$ that performs its $i^{th}$ t-read:
$\Read_{\phi}(X_i) \rightarrow nv_i$.
\end{itemize}
%
\end{claim}
%
\begin{proof}
%
$\mathcal{M}$ has an execution of the form $\rho^i\cdot \pi^{i-1}$.
Since $\Dset(T_k) \cap \Dset(T_{i}) =\emptyset$ in $\rho^i\cdot \pi^{i-1}$,
by Lemma~\ref{lm:hytm}, transactions $T_{\phi}$ and $T_i$ do not contend
on any base object in execution $\rho^i\cdot \pi^{i-1}$.
Thus, $\rho^i\cdot \pi^{i-1}$ is also an execution of $M$.

By opacity, $\rho^i\cdot \pi^{i-1} \cdot \alpha_i$ is an execution
of $M$ in which the t-read of $X_i$ performed by $T_{\phi}$ must return $nv_i$.
But $\rho^i \cdot \pi^{i-1} \cdot \alpha_i$ is indistinguishable to $T_{\phi}$ from
$\pi^{i-1}\cdot \rho^i \cdot \alpha_i$.
Thus, $M$ has an execution of the form $\pi^{i-1}\cdot \rho^i \cdot \alpha_i$.
\end{proof}
%
By Claim~\ref{cl:readdap}, for all $i\in \{2,\ldots, m\}$, $M$ has an execution of the form 
$E^{i}=\pi^{i-1}\cdot \rho^i \cdot \alpha_i$.

For each $i\in \{2,\ldots, m\}$, $j\in \{1,2\}$ and $\ell \leq (i-1)$, 
we now define an execution of the form  $\mathbb{E}_{j\ell}^{i}=\pi^{i-1}\cdot \beta^{\ell}\cdot \rho^i \cdot \alpha_j^i$
as follows:
%
\begin{itemize}
\item
%$\rho^m$ is defined as above;
$\beta^{\ell}$ is the t-complete step contention-free execution fragment of a fast-path transaction $T_{\ell}$
that writes $nv_{\ell}\neq v$ to $X_{\ell}$ and commits
\item
$\alpha_1^i$ (and resp. $\alpha_2^i$) is the complete step contention-free execution fragment of 
$\Read_{\phi}(X_i) \rightarrow v$ (and resp. $\Read_{\phi}(X_i) \rightarrow A_{\phi}$).
\end{itemize}
%
\begin{claim}
\label{cl:ic2}
For all $i\in \{2,\ldots, m\}$ and $\ell \leq (i-1)$, $\mathcal{M}$ has an execution of the form $\mathbb{E}_{1\ell}^{i}$ or 
$\mathbb{E}_{2\ell}^{i}$.
\end{claim}
%
\begin{proof}
%
For all $i \in \{2,\ldots, m\}$, $\pi^{i-1}$
is an execution of $\mathcal{M}$.
By assumption of invisible reads, $T_{{\ell}}$ must be committed in $\pi^{i-1}\cdot \rho^{\ell}$
and $M$ has an execution of the form $\pi^{i-1}\cdot \beta^{\ell}$.
By the same reasoning, since $T_i$ and $T_{\ell}$ do not have conflicting data sets,
$M$ has an execution of the form $\pi^{i-1}\cdot\beta^{\ell}\cdot \rho^i$.

Since the configuration after $\pi^{i-1}\cdot\beta^{\ell}\cdot \rho^i$ is quiescent,
$\pi^{i-1}\cdot\beta^{\ell}\cdot \rho^i$ extended with $\Read_{\phi}(X_i)$
must return a matching response.
If $\Read_{\phi}(X_i) \rightarrow v_i$, then clearly $\mathbb{E}_{1}^{i}$
is an execution of $M$ with $T_{\phi}, T_{i-1}, T_i$ being a valid serialization
of transactions.
If $\Read_{\phi}(X_i) \rightarrow A_{\phi}$, the same serialization
justifies an opaque execution.

Suppose by contradiction that there exists an execution of $\mathcal{M}$ such that
$\pi^{i-1}\cdot\beta^{\ell}\cdot \rho^i$ is extended with the complete execution
of $\Read_{\phi}(X_i) \rightarrow r$; $r \not\in \{A_{\phi},v\}$. 
The only plausible case to analyse is when $r=nv$.
Since $\Read_{\phi}(X_i)$ returns the value of $X_i$ updated by $T_i$, 
the only possible serialization for transactions is $T_{\ell}$, $T_i$, $T_{\phi}$; but $\Read_{\phi}(X_{\ell})$
performed by $T_k$ that returns the initial value $v$
is not legal in this serialization---contradiction.
\end{proof}
%
\begin{claim}
\label{cl:three}
For all $i\in \{2,\ldots, m\}$, $j\in \{1,2\}$ and $\ell \leq (i-1)$, transaction $T_{\phi}$ must access
$(i-1)$ different base objects during the execution of $\Read_{\phi}(X_i)$ in the execution
$\pi^{i-1}\cdot \beta^{\ell}\cdot \rho^i \cdot \alpha_j^i$.
\end{claim}
%
\begin{proof}
By the assumption of invisible reads,
the execution $\pi^{i-1}\cdot \beta^{\ell}\cdot \rho^i \cdot \alpha_j^i$
is indistinguishable to
transactions $T_{\ell}$ and $T_{i}$
from the execution ${\tilde \pi}^{i-1}\cdot \beta^{\ell}\cdot \rho^i \cdot \alpha_j^i$, where $\Rset(T_{\phi})=\emptyset$
in ${\tilde \pi}^{i-1}$.
But transactions $T_{\ell}$ and $T_{i}$ access mutually disjoint data sets in ${\tilde \pi}^{i-1}\cdot \beta^{\ell}\cdot \rho^i$ and by Lemma~\ref{cl:hytm},
they cannot contend on the same base object in this execution.

Consider the $(i-1)$ different executions: 
$\pi^{i-1}\cdot\beta^{1}\cdot \rho^i$, $\ldots$, $\pi^{i-1}\cdot\beta^{i-1}\cdot \rho^i$.
For all $\ell, \ell' \leq (i-1)$;$\ell' \neq \ell$, 
$M$ has an execution of the form $\pi^{i-1}\cdot \beta^{\ell}\cdot \rho^i \cdot \beta^{\ell'}$
in which transactions $T_{\ell}$ and $T_{\ell'}$ access mutually disjoint data sets.
By invisible reads and Lemma~\ref{lm:hytm}, the pairs of transactions $T_{\ell'}$, $T_{i}$ and $T_{\ell'}$, $T_{\ell}$
do not contend on any base object in this execution.
This implies that $\pi^{i-1}\cdot \beta^{\ell} \cdot \beta^{\ell'} \cdot \rho^i$ is an execution of $M$ in which
transactions $T_{\ell}$ and $T_{\ell'}$ each apply nontrivial primitives
to mutually disjoint sets of base objects in the execution fragments $\beta^{\ell}$ and $\beta^{\ell'}$ respectively.

This implies that for any $j\in \{1,2\}$, $\ell \leq (i-1)$, the configuration $C^i$ after $E^i$ differs from the configurations
after $\mathbb{E}_{j\ell}^{i}$ only in the states of the base objects that are accessed in the fragment $\beta^{\ell}$.
Consequently, transaction $T_{\phi}$ must access at least $i-1$ different base objects
in the execution fragment $\pi_j^i$
to distinguish configuration $C^i$ from the configurations
that result after the $(i-1)$ different executions 
$\pi^{i-1}\cdot\beta^{1}\cdot \rho^i$, $\ldots$, $\pi^{i-1}\cdot\beta^{i-1}\cdot \rho^i$ respectively.

Thus, for all $i \in \{2,\ldots, m\}$, transaction $T_{\phi}$ must perform at least $i-1$ steps 
while executing the $i^{th}$ t-read in $\pi_{j}^i$.
\end{proof}
%
However, this contradicts the assumption that in every execution $E$ of $\mathcal{M}$, any t-read operation $op_k$ performed by some slow-path transaction $T_k \in \ms{txns}(E)$
performs $\kappa$ steps. This completes the proof.
\end{proof}

